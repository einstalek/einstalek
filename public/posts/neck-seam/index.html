<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Eliminating Seams: Joining Separate Meshes with Blender | Underground Notes</title>
<meta name="keywords" content="blender, 3d, geometry">
<meta name="description" content="I recently encountered a problem working with 3D avatars: having a custom-generated head mesh, I needed to merge it seamlessly with the avatar&rsquo;s body. And since you can&rsquo;t go around asking 3D artists to do their magic all the time, here I suggest a simple solution for this type of problem.
Figure 1: Separate head and body meshes
To tackle this, one can make use of Blender&rsquo;s proportional editing, and as it turns out, it works pretty well.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/neck-seam/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b61fcfd045e796a8b2d82921640c6460592faab5e5c2c76d0ba1c0018405cbfa.css" integrity="sha256-th/P0EXnlqiy2CkhZAxkYFkvqrXlwsdtC6HAAYQFy/o=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/neck-seam/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Underground Notes (Alt + H)">Underground Notes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/cv/" title="CV">
                    <span>CV</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Eliminating Seams: Joining Separate Meshes with Blender
    </h1>
    <div class="post-meta"><span title='2024-08-10 00:00:00 +0000 UTC'>August 10, 2024</span>&nbsp;Â·&nbsp;3 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#finding-neck-seam-vertex-correspondences" aria-label="Finding Neck-Seam Vertex Correspondences">Finding Neck-Seam Vertex Correspondences</a></li>
                <li>
                    <a href="#proportional-editing" aria-label="Proportional editing">Proportional editing</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>I recently encountered a problem working with 3D avatars: having a custom-generated head mesh, I needed to merge it seamlessly with the avatar&rsquo;s body. And since you can&rsquo;t go around asking 3D artists to do their magic all the time, here I suggest a simple solution for this type of problem.</p>
<figure class="align-center ">
    <img loading="lazy" src="/posts/neck-seam/jBHQxtt.png#center"
         alt="Figure 1: Separate head and body meshes" width="100%"/> <figcaption>
            <p>Figure 1: Separate head and body meshes</p>
        </figcaption>
</figure>

<p>To tackle this, one can make use of Blender&rsquo;s proportional editing, and as it turns out, it works pretty well.</p>
<h3 id="finding-neck-seam-vertex-correspondences">Finding Neck-Seam Vertex Correspondences<a hidden class="anchor" aria-hidden="true" href="#finding-neck-seam-vertex-correspondences">#</a></h3>
<p>First, I needed to establish a vertex-to-vertex correspondence between the head and body neck seam vertices. This was fairly straightforward since I had an example of a head mesh that fit precisely onto the body. By measuring pairwise distances between head and body vertices, I found the desired correspondences.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># vertex indices of the neck seam on the body</span>
</span></span><span style="display:flex;"><span>body_seam_indices <span style="color:#f92672">=</span> [<span style="color:#f92672">...</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vertex indices of the neck seam on the head that fits the body </span>
</span></span><span style="display:flex;"><span>head_seam_indices <span style="color:#f92672">=</span> [<span style="color:#f92672">...</span>] 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get body seam vertex coordinates</span>
</span></span><span style="display:flex;"><span>body_verts <span style="color:#f92672">=</span> [bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects[body]<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>vertices[i]<span style="color:#f92672">.</span>co <span style="color:#66d9ef">for</span> \
</span></span><span style="display:flex;"><span>	i <span style="color:#f92672">in</span> body_seam_indices]
</span></span><span style="display:flex;"><span>body_verts <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(body_verts)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and head seam vertex coordinates</span>
</span></span><span style="display:flex;"><span>head_verts <span style="color:#f92672">=</span> [bpy<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>objects[src_head_key]<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>vertices[i]<span style="color:#f92672">.</span>co <span style="color:#66d9ef">for</span> \
</span></span><span style="display:flex;"><span>	i <span style="color:#f92672">in</span> head_seam_indices]
</span></span><span style="display:flex;"><span>head_verts <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(head_verts)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># find vertex-to-vertex correspondances by comparing distances</span>
</span></span><span style="display:flex;"><span>head_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(head_seam_indices))
</span></span><span style="display:flex;"><span>body_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmin(scipy<span style="color:#f92672">.</span>spatial<span style="color:#f92672">.</span>distance<span style="color:#f92672">.</span>cdist(head_verts, 
</span></span><span style="display:flex;"><span>	body_verts), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><h3 id="proportional-editing">Proportional editing<a hidden class="anchor" aria-hidden="true" href="#proportional-editing">#</a></h3>
<p>Using proportional editing, I can pull a vertex in a specific direction while influencing a certain zone around that vertex as well. The radius of this zone of influence is a hyperparameter in this approach. Let&rsquo;s see what happens if I go through the neck-seam vertex correspondences that I found and pull each head seam vertex towards its corresponding vertex from the neck seam.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>body_seam_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(body_seam_indices)[body_indices]
</span></span><span style="display:flex;"><span>head_seam_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(head_seam_indices)[head_indices]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># go through each seam vertex-pair</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, (head_vertex_index, body_vertex_index) <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>	zip(head_seam_indices, body_seam_indices)):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get target coordinate from the body vertex</span>
</span></span><span style="display:flex;"><span>    target_coord <span style="color:#f92672">=</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects[body]<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>vertices[body_vertex_index]<span style="color:#f92672">.</span>co
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># enter edit mode on the head that we will be editing</span>
</span></span><span style="display:flex;"><span>    obj <span style="color:#f92672">=</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects[head]
</span></span><span style="display:flex;"><span>    bpy<span style="color:#f92672">.</span>ops<span style="color:#f92672">.</span>object<span style="color:#f92672">.</span>mode_set(mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;EDIT&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># find initial head vertex coordinate and select that vertex</span>
</span></span><span style="display:flex;"><span>    bm <span style="color:#f92672">=</span> bmesh<span style="color:#f92672">.</span>from_edit_mesh(bpy<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>edit_object<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>    vertex <span style="color:#f92672">=</span> [v <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> bm<span style="color:#f92672">.</span>verts <span style="color:#66d9ef">if</span> v<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> head_vertex_index][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    vertex<span style="color:#f92672">.</span>select <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    init_coord <span style="color:#f92672">=</span> vertex<span style="color:#f92672">.</span>co
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># pull the head vertex with proportional editing</span>
</span></span><span style="display:flex;"><span>    translation <span style="color:#f92672">=</span> coord <span style="color:#f92672">-</span> init_coord
</span></span><span style="display:flex;"><span>    bpy<span style="color:#f92672">.</span>ops<span style="color:#f92672">.</span>transform<span style="color:#f92672">.</span>translate(value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>translation, 
</span></span><span style="display:flex;"><span>        proportional_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,  <span style="color:#75715e"># hyperparameter</span>
</span></span><span style="display:flex;"><span>        constraint_axis<span style="color:#f92672">=</span>(<span style="color:#66d9ef">False</span>, <span style="color:#66d9ef">False</span>, <span style="color:#66d9ef">False</span>),
</span></span><span style="display:flex;"><span>        mirror<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        use_proportional_edit<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        proportional_edit_falloff<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SMOOTH&#39;</span>
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><p>By the time we pull on the last vertex, the first one will have already shifted a bit from the target position. But repeating this a few times will reach a certain convergence pretty fast.</p>
<figure class="align-center ">
    <img loading="lazy" src="/posts/neck-seam/Bc02ovP.png#center"
         alt="Figure 2: Neck seam after 1, 2, 5 and 10 passes proposed editing" width="100%"/> <figcaption>
            <p>Figure 2: Neck seam after 1, 2, 5 and 10 passes proposed editing</p>
        </figcaption>
</figure>

<p>After ~10 passes the gap between two meshes is so small, that I can now just set head seam vertex corrdinates to the same ones as their corresponding body vertices.</p>
<figure class="align-center ">
    <img loading="lazy" src="/posts/neck-seam/vbT9g42.png#center"
         alt="Figure 3: Hard-setting seam vertices to target positions after 10 passes of proportional editing" height="512"/> <figcaption>
            <p>Figure 3: Hard-setting seam vertices to target positions after 10 passes of proportional editing</p>
        </figcaption>
</figure>

<h3 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h3>
<p>Described here is a very simple yet effective approach to joining two separate meshes with different seams. In my case, the vertex count of both seams was the same, but this solution can be extended to other cases as well.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/blender/">Blender</a></li>
      <li><a href="http://localhost:1313/tags/3d/">3d</a></li>
      <li><a href="http://localhost:1313/tags/geometry/">Geometry</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Underground Notes</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
